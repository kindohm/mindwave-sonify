<html>

<body>
  <h1>hi</h1>

  <script>
    document.addEventListener("DOMContentLoaded", function (event) {

      var ws = new WebSocket('ws:/localhost:8080');

      var audioContext = new AudioContext()

      var oscillator = audioContext.createOscillator();
      oscillator.connect(audioContext.destination);
      oscillator.type = 'square';
      oscillator.frequency.value = 400;

      var oscillator2 = audioContext.createOscillator();
      oscillator2.connect(audioContext.destination);
      oscillator2.type = 'square';
      oscillator2.frequency.value = 600;

      var vibrato = audioContext.createGain()
      vibrato.gain.value = 100;
      vibrato.connect(oscillator.detune);

      var vibrato2 = audioContext.createGain()
      vibrato2.gain.value = 100;
      vibrato2.connect(oscillator2.detune);

      var lfo = audioContext.createOscillator()
      lfo.connect(vibrato)
      lfo.frequency.value = 2;

      var lfo2 = audioContext.createOscillator()
      lfo2.connect(vibrato2)
      lfo2.frequency.value = 2;


      oscillator.start(audioContext.currentTime);
      lfo.start(audioContext.currentTime);
      oscillator2.start(audioContext.currentTime);
      lfo2.start(audioContext.currentTime);

      oscillator.stop(audioContext.currentTime + 1000);
      lfo.stop(audioContext.currentTime + 1000);
      oscillator2.stop(audioContext.currentTime + 1000);
      lfo2.stop(audioContext.currentTime + 1000);

      ws.onmessage = function (event) {
        var message = JSON.parse(event.data);
        console.log(message);

        if (message.type === 'meditation'){
          lfo.frequency.linearRampToValueAtTime(500/(message.data*2), audioContext.currentTime + 0.5);
          vibrato2.gain.linearRampToValueAtTime(message.data*60, audioContext.currentTime + 0.5);
        }

        if (message.type === 'attention'){
          lfo2.frequency.linearRampToValueAtTime(500/(message.data*2), audioContext.currentTime + 0.5);
          vibrato.gain.linearRampToValueAtTime(message.data*60, audioContext.currentTime + 0.5);
        }

        oscillator.frequency.linearRampToValueAtTime((500/(message.data*2)) * (message.data*60) * 0.1, audioContext.currentTime + 0.5);
        oscillator2.frequency.linearRampToValueAtTime((700/(message.data*2.1)) * (message.data*70) * 0.11, audioContext.currentTime + 0.5);

      };


    });
  </script>


</body>

</html>